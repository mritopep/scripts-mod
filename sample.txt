from zipfile import ZipFile
import os
import shutil
from shutil import copyfile

PWD = str(os.path.dirname(os.path.abspath(__file__))).replace("/scripts","/raw_data")

# file locations
DOWNLOAD=f'{PWD}/downloads/'
ADNI=f'{PWD}/data/adni/'
CANCER=f'{PWD}/data/cancer/'
EXTRACT=f'{PWD}/extracts/'
DIVIDE=f'{PWD}/parts/'
PREPROCESSED=str(os.path.dirname(os.path.abspath(__file__))).replace("/scripts","/preprocessed_data/")

def make_dir():
    dirs=[DOWNLOAD,EXTRACT,ADNI,CANCER,DIVIDE]
    for dir in dirs:
        try:
            os.makedirs(dir)  
        except:
            pass

def get_all_file_paths(directory):
    file_paths = []
    for root, directories, files in os.walk(directory):
        for filename in files:
            filepath = os.path.join(root, filename)
            file_paths.append(filepath)
    return file_paths   

def divide(name,path,parts):
    count=0
    divided_files=[]

    for file in next(os.walk(path))[1]:
        if(count%parts==0):
            files=[]
            divided_files.append(files)
        else:
            files.append(file)
        count+=1

    count=0

    for divide in divided_files:
        divided_file_paths = []
        count+=1
        for folder in divide:
            directory = f"{path}{folder}"
            file_paths = get_all_file_paths(directory)
            divided_file_paths.extend(file_paths)
            print('Following files will be zipped:')
            for file_name in file_paths:
                print(file_name)

        with ZipFile(f'{DIVIDE}{name}_{count}.zip','w') as zip:
            for file in divided_file_paths:
                zip.write(file)

        for folder in divide:
            directory = f"{path}{folder}"
            shutil.rmtree(directory)

if __name__ == "__main__":
    make_dir()
    divide("adni",PREPROCESSED,12)